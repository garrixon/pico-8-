pico-8 cartridge // http://www.pico-8.com
version 29
__lua__
--main

function _init()
	players = {}
	enemies = {}
	pbullets = {}
	ebullets = {}
	grounds = {}
 
 new_player(50,50)
 
 for x=0, 8 do
  for y=0, 8 do
   new_ground(x*16, y*16, y)
  end
  if x != 3 then
   new_enemy(x*16+2, x*16+2)
  end
 end
 
 
end

function _update60()
 for p in all(players) do
 	p:update()
 	for g in all(grounds) do
   if p and g and colliding(p, g) then
    del(grounds, g)
   end
  end  
 end
 for e in all(enemies) do
 	e:update()
 	for g in all(grounds) do
   if e and g and colliding(e, g) then
    del(grounds, g)
    e:turn()
   end
  end  	
 end
	for b in all(pbullets) do
 	b:update()
	 for e in all(enemies) do
	  if b and e and colliding(b, e) then
    del(enemies, e)
    del(pbullets, b)
   end
  end
  for g in all(grounds) do
   if b and g and colliding(b, g) then
    del(grounds, g)
    del(pbullets, b)
   end
  end
  if b and b.x < 0 then
   del(pbullets, b)
  end
  if b and b.x > 128 then
   del(pbullets, b)
  end
 end
end

function _draw()
 cls() 
 for g in all(grounds) do
  g:draw()
 end
 for p in all(players) do
	 p:draw() 
 end
 for e in all(enemies) do
	 e:draw() 
 end
 for b in all(pbullets) do
	 b:draw() 
 end
 for b in all(ebullets) do
	 b:draw() 
 end 
end



-->8
-- objects


-- players
function new_player(_x, _y)

	add(players, {
		x = _x,
		y = _y,
		w = 8,
		h = 8,
		left = false,
		face = 1,
		frate = 20,
		ftime = 0,
	 update = function(self)
	 	if self.ftime > 0 then
	 	 self.ftime -= 1
	 	elseif self.ftime < 0 then
	 	 self.ftime = 0
	 	end
	 	if btn(⬅️) then
				self.x-=1
				self.face = -1
				self.left = true
			end
			if btn(➡️) then
	 		self.x+=1
	 		self.face = 1
	 		self.left = false
			end
			if btn(⬆️) then
				self.y-=1
			end
			if btn(⬇️) then
			 self.y+=1
			end	
			if btn(❎) and self.ftime == 0  then
				new_pbullet(self.x+4, self.y+4, self.face)
				self.ftime = self.frate
			end
	 end,
	 draw = function(self)
			spr(1,self.x,self.y,1,1,self.left)
	 end
 })
end


-- enemies
function new_enemy(_x, _y)

	add(enemies, {
		x = _x,
		y = _y,
		w = 8,
		h = 8,
		face = 1,
		left = false,
	 update = function(self)
	 	if self.x > 120 then
				self.face = -1
				self.left = true
			elseif self.x < 0 then
	 		self.face = 1
	 		self.left = false
			end
			self.x += self.face * .5
			
	 end,
	 turn = function(self)
	 if self.left==true then
    self.face = 1
    self.left = false
  else
    self.face = -1
    self.left = true
   end
	 end,
	 draw = function(self)
 		spr(2,self.x,self.y,1,1,self.left)
	 end
 })
end


-- pbullets
function new_pbullet(_x, _y, _face)

	add(pbullets, {
		x = _x,
		y = _y,
		w = 1,
		h = 1,
		r = 1,
		c = 10,
		dx = 2*_face,
		dy = 0,
	 update = function(self)
			self.x += self.dx
			self.y += self.dy
			
	 end,
	 draw = function(self)
 		circfill(self.x, self.y,
 		 self.r, self.c)
	 end
 })
end




--ground
function new_ground(_x, _y, _c)

	add(grounds, {
		x = _x,
		y = _y,
		w = 15,
		h = 15,
		c = _c,
	 --update = function(self, _p)
		--	if colliding(self,_p)then
		--	 self.exist = 0
		--	end
	 --end,
	 draw = function(self)
 		 rectfill(self.x, self.y, self.x+self.w, self.y+self.h, self.c)
	 end
 })
end
-->8
-- utils

function colliding(_r1, _r2)
	return _r1.x < _r2.x + _r2.w and
   _r1.x + _r1.w > _r2.x and
   _r1.y < _r2.y + _r2.h and
   _r1.y + _r1.h > _r2.y 
	
end
-->8
-- updates
-->8
-- draws

__gfx__
000000000044400005555500004445d0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000004ffff00053333000445445d007777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
007007000ff1f1000332320044454445077766500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000770000fffff000333330044555445077666500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0007700067771755076536000445445d076666500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700f67717f0365357300445445d056665500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000005555500044444000445445d055555500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000500050003000300004445d0005555000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__label__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000555550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000533330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000332320000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000333330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000765360000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000003653573000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000444440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000300030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000001111111111111111111111111111111111111111111111111111111111111111
00000000000000000000000000000000000000000000000000000000000000001111111111111111111111111111111111111111111111111111111111111111
00000000000000000000000000000000000000005555500000000000000000001111111111111111111111111111111111111111111111111111111111111111
00000000000000000000000000000000000000003333500000000000000000001111111111111111111111111111111111111111111111111111111111111111
00000000000000000000000000000000000000002323300000000000000000001111111111111111111111111111111111111111111111111111111111111111
00000000000000000000000000000000000000003333300000000000000000001111111111111111111111111111111111111111111111111111111111111111
00000000000000000000000000000000000000006356700000000000000000001111111111111111111111111111111111111111111111111111111111111111
00000000000000000000000000000000000000037535630000000000000000001111111111111111111111111111111111111111111111111111111111111111
00000000000000000000000000000000000000004444400000000000000000001111111111111111111111111111111111111111111111111111111111111111
00000000000000000000000000000000000000003000300000000000000000001111111111111111111111111111111111111111111111111111111111111111
00000000000000000000000000000000000000000000000000000000000000001111111111111111111111111111111111111111111111111111111111111111
00000000000000000000000000000000000000000000000000000000000000001111111111111111111111111111111111111111111111111111111111111111
00000000000000000000000000000000000000000000000000000000000000001111111111111111111111111111111111111111111111111111111111111111
00000000000000000000000000000000000000000000000000000000000000001111111111111111111111111111111111111111111111111111111111111111
00000000000000000000000000000000000000000000000000000000000000001111111111111111111111111111111111111111111111111111111111111111
00000000000000000000000000000000000000000000000000000000000000001111111111111111111111111111111111111111111111111111111111111111
00000000000000000000000000000000000000000000000000000000000000000000000000000000222222222222222222222222222222222222222222222222
00000000000000000000000000000000000000000000000000000000000000000000000000000000222222222222222222222222222222222222222222222222
00000000000000000000000000000000000000000000000000000000005555500000000000000000222222222222222222222222222222222222222222222222
00000000000000000000000000000000000000000000000000000000003333500000000000000000222222222222222222222222222222222222222222222222
00000000000000000000000000000000000000000000000000000000002323300000000000000000222222222222222222222222222222222222222222222222
00000000000000000000000000000000000000000000000000000000003333300000000000000000222222222222222222222222222222222222222222222222
00000000000000000000000000000000000000000000000000000000006356700000000000000000222222222222222222222222222222222222222222222222
00000000000000000000000000000000000000000000000000000000037535630000000000000000222222222222222222222222222222222222222222222222
00000000000000000000000000000000000000000000000000000000004444400000000000000000222222222222222222222222222222222222222222222222
00000000000000000000000000000000000000000000000000000000003000300000000000000000222222222222222222222222222222222222222222222222
00000000000000000000000000000000000000000000000000000000000000000000000000000000222222222222222222222222222222222222222222222222
00000000000000000000000000000000000000000000000000000000000000000000000000000000222222222222222222222222222222222222222222222222
00000000000000000000000000000000000000000000000000000000000000000000000000000000222222222222222222222222222222222222222222222222
00000000000000000000000000000000000000000000000000000000000000000000000000000000222222222222222222222222222222222222222222222222
00000000000000000000000000000000000000000000000000000000000000000000000000000000222222222222222222222222222222222222222222222222
00000000000000000000000000000000000000000000000000000000000000000000000000000000222222222222222222222222222222222222222222222222
33333333333333333333333333333333333333333333333300000000000000003333333333333333333333333333333333333333333333333333333333333333
33333333333333333333333333333333333333333333333300000000000000003333333333333333333333333333333333333333333333333333333333333333
33333333333333333333333333333333333333333333333300004440000000003333333333333333333333333333333333333333333333333333333333333333
3333333333333333333333333333333333333333333333330004ffff000000003333333333333333333333333333333333333333333333333333333333333333
333333333333333333333333333333333333333333333333000ff1f1000000003333333333333333333333333333333333333333333333333333333333333333
333333333333333333333333333333333333333333333333000fffff000000003333333333333333333333333333333333333333333333333333333333333333
33333333333333333333333333333333333333333333333300677717550000003333333333333333333333333333333333333333333333333333333333333333
33333333333333333333333333333333333333333333333300f67717f00000003333333333333333333333333333333333333333333333333333333333333333
33333333333333333333333333333333333333333333333300055555000000003333333333333333333333333333333333333333333333333333333333333333
33333333333333333333333333333333333333333333333300050005000000003333333333333333333333333333333333333333333333333333333333333333
33333333333333333333333333333333333333333333333300000000000000003333333333333333333333333333333333333333333333333333333333333333
33333333333333333333333333333333333333333333333300000000000000003333333333333333333333333333333333333333333333333333333333333333
33333333333333333333333333333333333333333333333300000000000000003333333333333333333333333333333333333333333333333333333333333333
33333333333333333333333333333333333333333333333300000000000000003333333333333333333333333333333333333333333333333333333333333333
33333333333333333333333333333333333333333333333300000000000000003333333333333333333333333333333333333333333333333333333333333333
33333333333333333333333333333333333333333333333300000000000000003333333333333333333333333333333333333333333333333333333333333333
44444444444444444444444444444444000000000000000000000000000000000000000000000000000000000000000000000000000000004444444444444444
44444444444444444444444444444444000000000000000000000000000000000000000000000000000000000000000000000000000000004444444444444444
44444444444444444444444444444444000000000000000000000000000000000000000000000000000000000055555000000000000000004444444444444444
44444444444444444444444444444444000000000000000000000000000000000000000000000000000000000033335000000000000000004444444444444444
44444444444444444444444444444444000000000000000000000000000000000000000000000000000000000023233000000000000000004444444444444444
44444444444444444444444444444444000000000000000000000000000000000000000000000000000000000033333000000000000000004444444444444444
44444444444444444444444444444444000000000000000000000000000000000000000000000000000000000063567000000000000000004444444444444444
44444444444444444444444444444444000000000000000000000000000000000000000000000000000000000375356300000000000000004444444444444444
44444444444444444444444444444444000000000000000000000000000000000000000000000000000000000044444000000000000000004444444444444444
44444444444444444444444444444444000000000000000000000000000000000000000000000000000000000030003000000000000000004444444444444444
44444444444444444444444444444444000000000000000000000000000000000000000000000000000000000000000000000000000000004444444444444444
44444444444444444444444444444444000000000000000000000000000000000000000000000000000000000000000000000000000000004444444444444444
44444444444444444444444444444444000000000000000000000000000000000000000000000000000000000000000000000000000000004444444444444444
44444444444444444444444444444444000000000000000000000000000000000000000000000000000000000000000000000000000000004444444444444444
44444444444444444444444444444444000000000000000000000000000000000000000000000000000000000000000000000000000000004444444444444444
44444444444444444444444444444444000000000000000000000000000000000000000000000000000000000000000000000000000000004444444444444444
55555555555555555555555555555555555555555555555500000000000000000000000000000000000000000000000000000000000000000000000000000000
55555555555555555555555555555555555555555555555500000000000000000000000000000000000000000000000000000000000000000000000000000000
55555555555555555555555555555555555555555555555500000000000000000000000000000000000000000000000000000000005555500000000000000000
55555555555555555555555555555555555555555555555500000000000000000000000000000000000000000000000000000000003333500000000000000000
55555555555555555555555555555555555555555555555500000000000000000000000000000000000000000000000000000000002323300000000000000000
55555555555555555555555555555555555555555555555500000000000000000000000000000000000000000000000000000000003333300000000000000000
55555555555555555555555555555555555555555555555500000000000000000000000000000000000000000000000000000000006356700000000000000000
55555555555555555555555555555555555555555555555500000000000000000000000000000000000000000000000000000000037535630000000000000000
55555555555555555555555555555555555555555555555500000000000000000000000000000000000000000000000000000000004444400000000000000000
55555555555555555555555555555555555555555555555500000000000000000000000000000000000000000000000000000000003000300000000000000000
55555555555555555555555555555555555555555555555500000000000000000000000000000000000000000000000000000000000000000000000000000000
55555555555555555555555555555555555555555555555500000000000000000000000000000000000000000000000000000000000000000000000000000000
55555555555555555555555555555555555555555555555500000000000000000000000000000000000000000000000000000000000000000000000000000000
55555555555555555555555555555555555555555555555500000000000000000000000000000000000000000000000000000000000000000000000000000000
55555555555555555555555555555555555555555555555500000000000000000000000000000000000000000000000000000000000000000000000000000000
55555555555555555555555555555555555555555555555500000000000000000000000000000000000000000000000000000000000000000000000000000000
66666666666666666666666666666666666666666666666666666666666666660000000000000000000000000000000000000000000000000000000000000000
66666666666666666666666666666666666666666666666666666666666666660000000000000000000000000000000000000000000000000000000000000000
66666666666666666666666666666666666666666666666666666666666666660000000000000000000000000000000000000000000000000000000000555550
66666666666666666666666666666666666666666666666666666666666666660000000000000000000000000000000000000000000000000000000000333350
66666666666666666666666666666666666666666666666666666666666666660000000000000000000000000000000000000000000000000000000000232330
66666666666666666666666666666666666666666666666666666666666666660000000000000000000000000000000000000000000000000000000000333330
66666666666666666666666666666666666666666666666666666666666666660000000000000000000000000000000000000000000000000000000000635670
66666666666666666666666666666666666666666666666666666666666666660000000000000000000000000000000000000000000000000000000003753563
66666666666666666666666666666666666666666666666666666666666666660000000000000000000000000000000000000000000000000000000000444440
66666666666666666666666666666666666666666666666666666666666666660000000000000000000000000000000000000000000000000000000000300030
66666666666666666666666666666666666666666666666666666666666666660000000000000000000000000000000000000000000000000000000000000000
66666666666666666666666666666666666666666666666666666666666666660000000000000000000000000000000000000000000000000000000000000000
66666666666666666666666666666666666666666666666666666666666666660000000000000000000000000000000000000000000000000000000000000000
66666666666666666666666666666666666666666666666666666666666666660000000000000000000000000000000000000000000000000000000000000000
66666666666666666666666666666666666666666666666666666666666666660000000000000000000000000000000000000000000000000000000000000000
66666666666666666666666666666666666666666666666666666666666666660000000000000000000000000000000000000000000000000000000000000000
77777777777777777777777777777777777777777777777777777777777777777777777777777777000000000000000000000000000000000000000000000000
77777777777777777777777777777777777777777777777777777777777777777777777777777777000000000000000000000000000000000000000000000000
77777777777777777777777777777777777777777777777777777777777777777777777777777777000000000000000000000000005555500000000000000000
77777777777777777777777777777777777777777777777777777777777777777777777777777777000000000000000000000000003333500000000000000000
77777777777777777777777777777777777777777777777777777777777777777777777777777777000000000000000000000000002323300000000000000000
77777777777777777777777777777777777777777777777777777777777777777777777777777777000000000000000000000000003333300000000000000000
77777777777777777777777777777777777777777777777777777777777777777777777777777777000000000000000000000000006356700000000000000000
77777777777777777777777777777777777777777777777777777777777777777777777777777777000000000000000000000000037535630000000000000000
77777777777777777777777777777777777777777777777777777777777777777777777777777777000000000000000000000000004444400000000000000000
77777777777777777777777777777777777777777777777777777777777777777777777777777777000000000000000000000000003000300000000000000000
77777777777777777777777777777777777777777777777777777777777777777777777777777777000000000000000000000000000000000000000000000000
77777777777777777777777777777777777777777777777777777777777777777777777777777777000000000000000000000000000000000000000000000000
77777777777777777777777777777777777777777777777777777777777777777777777777777777000000000000000000000000000000000000000000000000
77777777777777777777777777777777777777777777777777777777777777777777777777777777000000000000000000000000000000000000000000000000
77777777777777777777777777777777777777777777777777777777777777777777777777777777000000000000000000000000000000000000000000000000
77777777777777777777777777777777777777777777777777777777777777777777777777777777000000000000000000000000000000000000000000000000

